/* version: v6-guard-2 */
:root{
  --bg:#0f172a;/* slate-900 */
  --panel:#111827;/* gray-900 */
  --muted:#94a3b8;/* slate-400 */
  --text:#e5e7eb;/* gray-200 */
  --accent:#22c55e;/* green-500 */
  --warn:#f59e0b;/* amber-500 */
  --danger:#ef4444;/* red-500 */
}
*{box-sizing:border-box}
html,body,#root{height:100%}
#root{ position: relative; min-height: 100%; }
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  background: linear-gradient(180deg,#0b1020,#0f172a);
  color:var(--text);
}
.app{
  max-width: 960px;
  margin: 0 auto;
  padding: 24px 16px 56px;
  position: relative; /* v6 inline-anchor: force root relative */
  isolation: isolate; /* create new stacking context to avoid stray overlays */
}
.toolbar{
  display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:flex-start;
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.08);
  border-radius:12px;padding:12px 14px;margin-bottom:16px;
}
.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.seg{
  display:flex;gap:6px;flex-wrap:wrap;background:#0b1222;border:1px solid rgba(255,255,255,0.08);border-radius:10px;padding:6px
}
.seg button{background:transparent;border:none;color:var(--muted);padding:8px 10px;border-radius:8px;cursor:pointer}
.seg button.active{background:#172036;color:var(--text)}
.seg button:disabled{opacity:.5;cursor:not-allowed}
.btn{
  background:#162238;border:1px solid rgba(255,255,255,0.1);color:var(--text);
  padding:10px 14px;border-radius:10px;cursor:pointer
}
.btn:disabled{opacity:.6;cursor:not-allowed}
.btn.primary{background:#18324a;border-color:#255;
}
.card{
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.08);
  border-radius:14px;padding:18px;margin:12px 0
}
.question{font-size:18px;line-height:1.5}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;margin-top:12px}
.opt{background:#0b1222;border:1px solid rgba(255,255,255,0.08);padding:12px;border-radius:10px;cursor:pointer;text-align:center;color:var(--text)}
.opt:disabled{opacity:.85}
.opt.correct{outline:2px solid var(--accent)}
.opt.wrong{outline:2px solid var(--danger)}
.muted{color:var(--muted)}
.stats{display:grid;gap:16px;grid-template-columns:repeat(2,minmax(0,1fr))}
@media (min-width: 768px){
  .stats{grid-template-columns:repeat(4,minmax(0,1fr))}
}
.badge{background:#0c1a2f;border:1px solid rgba(255,255,255,0.08);padding:6px 10px;border-radius:999px}
.bigtime{font-variant-numeric: tabular-nums; font-size:28px}
.overlay{
  position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
  background:rgba(0,0,0,0.5);backdrop-filter: blur(2px)
}
.panel{background:#0e1729;border:1px solid rgba(255,255,255,0.1);padding:24px 20px;border-radius:14px}

/* --- UI fix fallback --- */
.qwrap { position: relative; min-height: 280px; overflow: visible; }
.board-col{ position:relative; width:clamp(280px,22vw,320px); max-width: 320px; margin-left:auto; }
@media (max-width: 1024px) {
  .board-col { display: none; }
}
.question-panel { position: relative; min-height: 280px; overflow: hidden; }
.text-balance { text-wrap: balance; }
.break-safe { word-break: break-word; }

/* prevent vertical writing from any global style */
.range-panel, .qwrap, body{ writing-mode: horizontal-tb; }

/* Hard kill any leftover overlay/portal usage */
.overlay-card, [data-overlay="board"] { display: none !important; }
.board-portal { display: none !important; }

/* Show board only when inside right column */
#board-mini-root{ position: relative !important; inset: auto !important; transform-origin: top left !important; }
.board-col #board-mini-root{ display:block !important; }

/* grid 12 layout for question */
.layout-12{ display:grid; grid-template-columns: 1fr; gap:16px }
.layout-12 .col-main{ grid-column: 1 / -1 }
.layout-12 .board-col{ grid-column: 1 / -1 }
@media (min-width: 1024px){
  .layout-12{ grid-template-columns: repeat(12, minmax(0, 1fr)); }
  .layout-12 .col-main{ grid-column: span 8 }
  .layout-12 .board-col{ grid-column: span 4 }
}

/* RANGE3 side grid: 1列で縦積み */
.range-grid{ grid-template-columns:1fr }

/* Gamification + time bar */
.timebar{position:relative;height:8px;width:220px;background:#0b1222;border:1px solid rgba(255,255,255,0.08);border-radius:999px;overflow:hidden}
.timebar .fill{height:100%;background:linear-gradient(90deg,#22c55e,#f59e0b);transition:width .25s ease}
.toast{position:fixed;top:16px;left:50%;transform:translateX(-50%);background:#0c1a2f;border:1px solid rgba(255,255,255,0.16);padding:8px 14px;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,0.4);animation:pop .35s ease}
@keyframes pop{0%{transform:translateX(-50%) scale(.9);opacity:0}60%{transform:translateX(-50%) scale(1.04);opacity:1}100%{transform:translateX(-50%) scale(1);opacity:1}}
.opt.correct{outline:2px solid var(--accent);animation:pulse .2s ease}
.opt.wrong{outline:2px solid var(--danger);animation:shake .25s ease}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.02)}100%{transform:scale(1)}}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-2px)}75%{transform:translateX(2px)}}

/* Combo badge color + blink (CSS only) */
/* Default active style (applies when streak >= 3) */
.stats .badge:nth-of-type(7){
  color:#ffd166;
  border-color:rgba(255,209,102,0.6);
  background:
    radial-gradient(120px 120px at 20% 30%, rgba(255,200,100,0.15), transparent),
    #0c1a2f;
  box-shadow:0 0 0 0 rgba(255,200,100,0.35);
  animation:comboGlow 1.1s ease-in-out infinite;
}
/* When streak is 0..2, pause animation and revert colors */
.app[data-streak="0"] .stats .badge:nth-of-type(7),
.app[data-streak="1"] .stats .badge:nth-of-type(7),
.app[data-streak="2"] .stats .badge:nth-of-type(7){
  color:var(--text);
  border-color:rgba(255,255,255,0.08);
  background:#0c1a2f;
  box-shadow:none;
  animation:none;
}
@keyframes comboGlow{
  0%{ box-shadow:0 0 0 0 rgba(255,200,100,0.35); }
  60%{ box-shadow:0 0 18px 6px rgba(255,200,100,0.0); }
  100%{ box-shadow:0 0 0 0 rgba(255,200,100,0); }
}

/* Poker table + cards */
.poker-wrap{display:flex;justify-content:center}
.felt{background:radial-gradient(140px 80px at 50% 40%, rgba(34,197,94,0.2), transparent), #0b1f15; border:1px solid rgba(255,255,255,0.08); border-radius:16px; padding:16px; max-width:100%}
.board-cards,.hole-cards{display:flex;gap:8px;align-items:center;justify-content:center}
.board-cards{margin-bottom:8px}
.hole-cards{opacity:.9}
.pos-badge{margin-top:8px;text-align:center;font-size:12px;color:#ffd166}
.card{width:48px;height:64px;border-radius:8px;background:#eaecef;color:#111;display:flex;align-items:center;justify-content:center;border:1px solid rgba(0,0,0,0.15);box-shadow:0 2px 8px rgba(0,0,0,0.3)}
.card.lg{width:56px;height:76px}
.card.md{width:52px;height:72px}
.card.back{background:repeating-linear-gradient(45deg,#0e2536,#0e2536 6px,#113047 6px,#113047 12px);border-color:rgba(255,255,255,0.12)}
.pip{font-weight:700}
.pip.red{color:#d43c3c}

/* ==== CSS-only hotfix (simple) =================================== */
/* 1) 質問パネル内に右カラムを“固定”配置し、左側に余白を確保 */
.qwrap{
  position: relative;
  padding-right: 352px;           /* 320px(右カラム) + 32px(間隔) */
  min-height: 320px;
  overflow: visible;
}

/* 右カラム（ボードプレビュー置き場）を qwrap の右上に固定 */
.qwrap .board-col{
  position: absolute;
  right: 16px;
  top: 16px;
  width: 320px;
  max-width: 320px;
  margin: 0;
  display: block;
  z-index: 1;
}

/* 小画面では右カラムを非表示にして本文を全幅に */
@media (max-width: 1024px){
  .qwrap{ padding-right: 0; }
  .qwrap .board-col{ display: none; position: static; width: auto; max-width: none; }
}

/* 2) ボードの基準要素は必ず relative（過去の static を上書き） */
#board-mini-root{
  position: relative !important;
  inset: auto !important;
  transform-origin: top left !important;
}

/* 3) 統計チップは固定グリッド（折返しでズレない） */
.stats{
  display: grid;
  grid-template-columns: repeat(2, minmax(0,1fr));
  gap: 12px;
}
@media (min-width: 768px){
  .stats{ grid-template-columns: repeat(4, minmax(0,1fr)); }
}

/* 4) 文字は横書き＆安全改行（縦長化/はみ出し防止） */
:root, body, .qwrap{ writing-mode: horizontal-tb; }
.qwrap *{ white-space: normal; word-break: break-word; }

/* 5) 念のため旧オーバーレイ類は全て無効化 */
.overlay-card, [data-overlay="board"], .board-portal{ display: none !important; }
/* ================================================================ */
